# 启动环境

- ubuntu

```python
# 启动服务
sudo service mysql start 
# 查看进程中是否存在mysql服务
ps ajx|grep mysql
# 停止服务
sudo service mysql stop
# 重启服务
sudo service mysql restart

# 帮助文档
mysql --help
# 基本连接
mysql -uroot -pmysql
# 远程连接
mysql -h 192.168.5.400 -uroot -pmysql -P 5001
# 若数据库过大，可以使用快捷方式进入，防止预读
mysql -h 192.168.5.400 -uroot -pmysql -P 5001 -A

# 退出
quit/exit/ctrl+d
```

- windows

```python
# 启动服务
net start mysql
# 关闭服务
net stop mysql
# 帮助文档
mysql --help
# 基本连接
mysql -uroot -pmysql
# 退出
quit/exit
```

# 系统相关

引擎

```python
# 查看默认引擎
show engines

# 更改默认引擎
# 方法一：在配置文件中更改，后重启
default-storage-engine=InnoDB
# 方法二：建表的时候指定
create table mytbl(   
    id int primary key,   
    name varchar(50)   
)type=MyISAM;
# 方法三：建表后修改
alter table mytbl2 type = InnoDB;
```

全球化与本地化

```sql
# 字符集：为字母和符号的集合
# 编码：为摸个字符集成员的内部表示
# 校对：为规定字符如何比较的指令

# 查看支持的字符集
show character set;
# 查看支持的校对
show collation;

eg:
create table mytable
(
	column1 int,
    column2 varchar(10),
    column3 varchar(10) character set latin1 collate latin1_general_ci
)
default character set hebrew
collate hebrew_general_ci
```

字符集显示，防止客户端乱码

```sql
# 查看包含character开头的全局变量
show variables like 'character%';

# 修改client,connection,results的编码为GBK，保证和DOS命令行保持一致（GBK为举例）
set character_set_client=gbk; # 修改客户端字符集
set character_set_connection=gbk; # 修改连接的字符集
set character_set_results=gbk; # 修改查询的结果字符集
set names gbk;  # 同时设置三项
```

其他

```sql
# 查看db server状态
show status;
# 查看mysql的系统环境变量
show variables;
# 查看执行命令
show processlist;
```

# 日志查看

```sql
# 1.使用processlist
# 查看正在执行的sql语句
use information_schema;
show processlist;
# 或者
select * from information_schema.`PROCESSLIST` where info is not null;

# 2.日志模式
# 设置
SET GLOBAL log_output = 'TABLE';SET GLOBAL general_log = 'ON';  # 日志开启
SET GLOBAL log_output = 'TABLE'; SET GLOBAL general_log = 'OFF';  # 日志关闭
# 查询
SELECT * from mysql.general_log ORDER BY event_time DESC;
# 清空，delete对于这个表，不允许使用，只能用truncate）
truncate table mysql.general_log;
```

# 对用户操作

```sql
# 查看用户表结构
use mysql;
desc user;
# 查看用户
select host,user,authentication_string from user;
# 查看用户权限
show grants for '用户名'@'主机ip';

# 创建用户
create user 用户名@允许连接的主机IP identified by '密码';
create user 'test'@'%' identified by 'test';  # ip用% 时表示所有ip均可
create user 'test'@'127.0.0.1' identified by 'test';
create user 'ben' identified by 'p@$$w0rd';

# 删除用户
drop user '用户名'@'允许连接的主机IP';
delete from mysql.user where user = '用户名' and host = '允许连接的主机IP';
drop user ben;

# 重命名用户账号
rename user ben to bforta;


# 设置权限
grant 权限 on 数据库.* to '用户名'@'允许连接的主机IP'; # 需要用户存在
grant 权限 on 数据库.* to '用户名'@'允许连接的主机IP' identified by '密码'; # 自动创建一个用户
# eg
grant select on test.* to 'test'@'localhost'; # 为test用户设置test数据库的查询权限
grant all privileges on test.* to 'test'@'localhost'; # 为test用户设置test数据库的所有权限

# 回收权限
revoke insert on python.* from 'py1'@'%';
revoke all on test.* from 'user1'@'localhost';

# 修改用户密码
# root用户
# 未登录mysql
mysqladmin -uroot -p password 新密码;
# 登录数据库
select user();
set password=password('123456'); 
flush privileges;
exit;
# 普通用户
set password for '用户名'@'主机ip' = password('new password');
set password = password('new password');  # 当前用户
update mysql.user set authentication_string = password('新密码') where user = '用户名' and host = '允许连接的主机IP'; # 直接手动修改

# 修改完成，需刷新权限
flush privileges;

# 忘记密码
在配置文件中添加
skip-grant-tables
重启服务，再设置密码
退出服务，注释掉代码
重启服务
```

# 数据库操作

```sql
# 查看所有数据库
show databases;
# 查看创建数据库的语句
show create database xxx;

# 切换数据库
use xxx;
# 显示数据库版本
select version();
# 显示时间
select now();
# 查看当前使用得数据库
select database();

# 创建数据库
create database xxx;
create database if not exists xxx;  # 判断数据库是否已存在，不存在则创建
# 默认字符集是latin1(拉丁文，不支持中文)
create database xxx charset=utf8;
create database xxx character set utf8;

# 修改数据库字符集
alter database xxx charset=utf8;
alter database xxx character set utf8;

# 删除数据库
drop database xxx;
# 修改输入提示符
prompt python>

# 数据库的备份
# ubuntu下运行
mysqldump –uroot –p 数据库名 > python.sql;
# 数据库的恢复
# 连接mysql，创建新的数据库，退出连接，执行如下命令
mysql -uroot –p 新数据库名 < python.sql
```

# 数据表操作

创建

```sql
# 基本语法
create table zzz(
	  id int unsigned not null primary key auto_increment,
	  name varchar(20) not null,
   	age tinyint unsigned default 0,
    height decimal(5,2),
    gender enum('男','女','保密'),
    cls_id int unsigned default 0,
    foreign key(cls_id) references classes(id)
);

# 创建一个表结构相同的表
create table xxx like zzz;

# 蠕虫复制
CREATE TABLE `runoob_tbl` (
  `runoob_id` int(11) NOT NULL auto_increment,
  `runoob_title` varchar(100) NOT NULL default '',
  `runoob_author` varchar(40) NOT NULL default '',
  `submission_date` date default NULL,
  PRIMARY KEY  (`runoob_id`),
  UNIQUE KEY `AUTHOR_INDEX` (`runoob_author`)
) ENGINE=InnoDB;
# 复制表结构
create table clone_tbl like runoob_tbl;
# 克隆数据
INSERT INTO clone_tbl (runoob_id, runoob_title, runoob_author, submission_date)
SELECT runoob_id,runoob_title, runoob_author, submission_date
FROM runoob_tbl;
```

查看

```sql
# 查看当前数据库中所有表
show tables;
# 查看数据表状态
show table status;
# 查看表结构
desc zzz;
# 查看表的创建语句
show create table zzz;

# 查看列
SHOW COLUMNS FROM tbl_name [FROM db_name]     #列出资料表字段
SHOW FIELDS FROM tbl_name [FROM db_name]			# DESCRIBE tbl_name [col_name]。
SHOW FULL COLUMNS FROM tbl_name [FROM db_name]# 列出字段及详情
SHOW FULL FIELDS FROM tbl_name [FROM db_name] # 列出字段完整属性
SHOW INDEX FROM tbl_name [FROM db_name]       # 列出表索引。

# 查看一个表的所有列名
select COLUMN_NAME from information_schema.COLUMNS where table_name = 'your_table_name' and table_schema = 'your_db_name';  
```
修改
```sql
# 修改表名字
rename table zzz to new_name;
# 修改表字符集
alter table zzz charset utf8;
alter table zzz character set utf8;
# 修改自增起始值
alter table xxx auto_increment=2000;

# 修改表-添加字段
alter table students add birthday datetime;

# 修改表-修改字段：重命名版
alter table students change birthday birth datetime not null;
# 修改表-修改字段：不重命名版
alter table students modify birth date not null;

# 修改表-删除字段
alter table students drop birthday
```
删除
```sql
drop table zzz;  #  直接删除表
drop table if exists xxx;  # 判断表是否存在，若存在则删除
```

# 数据行操作

## 增

```sql
# 全列插入一行
insert into students values(0,'郭靖',1,'蒙古','2016-1-2');
# 部分列插入一行
insert into students(name,hometown) values('黄蓉','桃花岛');
# 多行插入
insert into classes values(0,'python1'),(0,'python2');
# 插入select语句
insert into  classes select clas_id from students where id=3;
# 多行多列插入(字段需一致)
INSERT INTO TPersonnelChange(
    UserId,
    DepId,
    SubDepId,
    PostionType,
    AuthorityId,
    ChangeDateS,
    InsertDate,
    UpdateDate,
    SakuseiSyaId
)SELECT
    UserId,
    DepId,
    SubDepId,
    PostionType,
    AuthorityId,
    DATE_FORMAT(EmployDate, '%Y%m%d'),
    NOW(),
    NOW(),
    1
FROM
    TUserMst
WHERE
    `Status` = 0
AND QuitFlg = 0
AND UserId > 2
```

## 删

```sql
# 物理删除
delete from students where id=5;
# 逻辑删除
update students set isdelete=1 where id=1;
# 删除表中所有记录
truncate table xxx;
```

## 改

```sql
# 改特定的行和列
update students set gender=0,hometown='北京' where id=5;

# 批量改
# 单个字段
UPDATE mytable
  SET myfield = CASE other_field
    WHEN 1 THEN 'value'
    WHEN 2 THEN 'value'
    WHEN 3 THEN 'value'
  END
WHERE id IN (1,2,3)
# 多个字段
UPDATE categories
  SET display_order = CASE id
    WHEN 1 THEN 3
    WHEN 2 THEN 4
    WHEN 3 THEN 5
  END,
  title = CASE id
    WHEN 1 THEN 'New Title 1'
    WHEN 2 THEN 'New Title 2'
    WHEN 3 THEN 'New Title 3'
  END
WHERE id IN (1,2,3)
```

## 查

由于Console的宽度有限，因此在查询数据库记录时，就会出现不能在一行完全显示全部字段内容的情况，于是为查询带了很大不便。现在只需在查询语句后面加一个`\G`，就可以实现记录的竖行显示

### 普通查询

```sql
# 所有列
select * from 表名;
# 指定列
select 字段名,字段名 from 表名;
# 指定多行
select 字段名 from 表名 limit 0,10;	# 前10行，参1：起始行数，参2：返回的行数

# 字段别名
select 字段名 as 别名 from 表名;
# 使用运算符
select 字段名 + 字段名 as '别名' from 表名;

# 滤空修正
select ifnull(字段名,替换值) from 表名;

# 排序
# asc 表示升序
select * from 表名 where 查询条件 order by 字段名 asc, 字段名 asc; 
# desc 表示降序排列
select * from 表名 where 查询条件 order by 字段名 desc, 字段名 desc;
```

### 重复数据

统计重复数据

```sql
# 表中 first_name 和 last_name的重复记录数
SELECT COUNT(*) as repetitions, last_name, first_name
FROM person_tbl
GROUP BY last_name, first_name
HAVING repetitions > 1;
```

过滤重复数据

```python
# 当指定多个字段时，多个字段必须全部匹配才会成功
select distinct 字段名 from 表名; 
```

删除重复数据

```sql
# 方法一：创建新表删除旧表
CREATE TABLE tmp SELECT last_name, first_name, sex FROM person_tbl  GROUP BY (last_name, first_name, sex);
DROP TABLE person_tbl;
ALTER TABLE tmp RENAME TO person_tbl;

# 方法二：新增索引
ALTER IGNORE TABLE person_tbl
ADD PRIMARY KEY (last_name, first_name);
```

### 条件查询

```python
# =,>,>=,<,<=
select * from 表名 where 字段名 > 3; 
# !=,<>
select * from 表名 where 字段名 != 3; 
# 多值
select * from 表名 where 字段名 in (3,5); 
# 区间
select * from 表名 where 字段名 between 3 and 5; 
# 空值
select * from 表名 where 字段名 is null; 
# and,or,not
select * from 表名 where 字段名 is not null;
select * from 表名 where 字段名 = ? and 字段名 = ?; 
select * from 表名 where 字段名 = ? or 字段名 = ?;
```

模糊查询

```python
# % 表示任意个数的任意字符
select * from 表名 where 字段名 like '%xxx%';
select * from 表名 where 字段名 not like '%xxx%'; 
# _ 表示单个的任意字符
select * from 表名 where 字段名 like '_xxx';
# [] 表示单个字符的取值范围
select * from 表名 where 字段名 rlike '[0-9]abc'; 
# [^] 表示单个字符的非取值范围
select * from 表名 where 字段名 rlike '[^0-9]abc';
# \ 表示转义,查询字段中包含%的数据
select * from 表名 where 字段名 like '%\%%'; 
```

### 字符串拼接

- `concat`

```
# 功能
将多个字符串连接为一个字符串

# 语法
CONCAT(str1,str2,…)  
返回结果为连接参数产生的字符串。如有任何一个参数为NULL ，则返回值为 NULL。
注意：
如果所有参数均为非二进制字符串，则结果为非二进制字符串。 
如果自变量中含有任一二进制字符串，则结果为一个二进制字符串。
一个数字参数被转化为与之相等的二进制字符串格式；若要避免这种情况，可使用显式类型 cast,
SELECT CONCAT(CAST(int_col AS CHAR), char_col)
```
举例
```sql
select concat(id,name,score) as info from t1;  # 中间无间隔
select concat(id, ',', name, ',', score) as info from t1;  # 中间用逗号间隔
```

- `concat_ws`

```
# 功能
和concat()一样，将多个字符串连接成一个字符串，但是可以一次性指定分隔符～（concat_ws就是concat with separator，是CONCAT()的特殊形式）

# 语法
CONCAT_WS(separator,str1,str2,...)
第一个参数是其它参数的分隔符。分隔符的位置放在要连接的两个字符串之间。分隔符可以是一个字符串，也可以是其它参数。
注意：
如果分隔符为 NULL，则结果为 NULL。函数会忽略任何分隔符参数后的 NULL 值。
```
举例
```sql
selct concat_ws(',',id,name,score) as info from t1;
```

- `group_concat`

```
在有group by的查询语句中，select指定的字段要么就包含在group by语句的后面，作为分组的依据，要么就包含在聚合函数中。
# 功能
将group by产生的同一个分组中的值连接起来，返回一个字符串结果

# 语法
group_concat([DISTINCT] 要连接的字段 [Order BY ASC/DESC 排序字段] [Separator '分隔符'])
通过使用distinct可以排除重复值；如果希望对结果中的值进行排序，可以使用order by子句；separator是一个字符串值，缺省为一个逗号
```
举例
```sql
select name, group_concat(id) from t2 group by name;
select name, group_concat(id order by id desc separator '_') from t2 group by name;
select name, group_concat(concat_ws('-', id, score) order by id) from t2 group by name;
select name, group_concat(concat_ws('-', id, score) order by id separator '_') from t2 group by name;
```

### 分组查询

```python
# 特定条件
select 字段名 from 表名 where 查询条件 group by 字段名 having 查询条件;
# group_concat
select 字段名1,group_concat(字段名2) from 表名where 查询条件 group by 字段名1 having 查询条件;
# 聚合函数max,min,avg,sum,count
select name, avg(score), sum(score>60) as cnt from student group by name
# 在最后新增一行，记录当前列的所有记录总和
select gender,count(*) from students group by gender with rollup;
```

where与having区别

```
where子句：对查询结果进行分组前，将不符合where条件的去掉，先过滤再分组；where后面不可以使用聚合函数
having子句：筛选满足条件的组，先分组再过滤；having后面可以使用聚合函数
```

### 嵌套查询

```python
# 当子查询返回的值只有一个时，才可以直接使用 =,>,< 等运算符;
# 当子查询返回的值是一个结果集时，需要使用 in,not in,any,some,all 等操作符;
# all : 匹配结果集中的所有结果, 例如 > all 表示比所有结果都大;
# any : 匹配结果信中任意一个结果, 例如 < any 表示只要比其中任意一个小就符合条件;
# in : 查询的数据在子查询的结果集中,相当于 = any;
# not in : 查询的数据不在子查询结果集中,相当于 <> all;
# some : 匹配结果集中的部分结果，基本等同于 any,不常用;
# 子查询通常只用于返回单个字段的结果集，如果需要匹配多个字段，可以使用多表联查(后面讲);
select * from 表名 where 字段名 = (select 字段名 from 表名 where 字段名=?);
select * from 表名 where 字段名 > all (select 字段名 from 表名);
select * from 表1, (select * from table_name) m where 表1.字段=m.字段;
```

### 多表联查

```python
# 数据表的别名
select * from 表名 as 别名; 

#  交叉连接(笛卡尔积)，显示两张表的乘积
select * from 表1 cross join 表2 on 连接条件 where 查询条件; # cross join on 可省略
select * from 表1,表2 where 查询条件;  # 默认就是交叉连接,如果 where 条件中有等值判断则称为等值连接

# 左外连接，左显全集,右显交集
select * from 表1 left outer join 表2 on 连接条件 where 查询条件; # outer 可省略
# 右外连接，左显交集,右显全集
select * from 表1 right outer join 表2 on 连接条件 where 查询条件; # outer 可省略
# 内连接，表的交集
select * from 表1 inner join 表2 on 连接条件 where 查询条件; # 显式两张表的交集，inner 可省略

# 联合查询
# 显示两张表的并集,要求两张表的查询字段名必须保持一致
select id,name from 表1 union select id,name from 表2;
# 全外连接(MySQL不支持)
# 显示两张表的并集
select * from 表1 full outer join 表2 on 连接条件 where 查询条件; //outer 可省略
# 可以通过左外连接和右外连接的联合查询来实现
select * from 表1 left join 表2 on 连接条件 where 查询条件 union select * from 表1 right join 表2 on 连接条件 where 查询条件;
```

### 常用函数

聚合

```sql
select min(字段名) from 表名;
select max(字段名) from 表名;
select avg(字段名) from 表名;
select round(avg(字段名), 2) from 表名;
select count(字段名) from 表名;
select sum(字段名) from 表名;
```

字符串

```sql
# upper 和 ucase
# 把所有字符转换为大写字母
select upper(name) from 表名;
# lower 和 lcase
# 把所有字符转换为小写字母
select lcase(name) from 表名;
# replace(str, from_str, to_str)
# 把str中的from_str替换为to_str
select replace(字段名,替换前的值,替换后的值) from 表名;
#  repeat(str,count)
# 返回str重复count次的字符串
select repeat('abc',2) from 表名; // abcabc
#  reverse(str)
# 逆序字符串
select reverse('abc') from 表名; // cba
#  insert(str,pos,len,newstr)
# 把str中pos位置开始长度为len的字符串替换为newstr
select insert('abcdef',2,3,'hhh'); // ahhhef
#  substring(str from pos)
# 从str中的pos位置开始返回一个新字符串 
select substring('abcdef',3); // cdef
# substring_index(str,delim,count)
# 返回str中第count次出现的delim之前的所有字符,如果count为负数,则从右向左
select substring_index('abacadae','a',3); // abac
# ltrim(str)
# 去除字符串左边的空格
select ltrim(' abc');
# rtrim(str)
# 去除字符串右边的空格
select rtrim('abc ');
#  trim(str)
# 去除字符串左右两边的空格
select trim(' abc ');
# mid(str,pos,len)
# 从str中的pos位置开始返回len个长度的字符串
select mid('abcdef',2,3); // bcd
# lpad(str,len,padstr)
# 在str左边填充padstr直到str的长度为len
select lpad('abc',8,'de'); // dededabc
# rpad(str,len,padstr)
# 在str右边填充padstr直到str的长度为len
select rpad('abc',8,'de'); // abcdeded
#  left(str,len)
# 返回str左边的len个字符
select left('abcd',2); // ab
# right(str,len)
# 返回str右边的len个字符
select right('abcd',2); // cd
# position(substr in str)
# 返回substr在str中第一次出现的位置
select position('c' in 'abcdc'); // 3
# length(str)
# 返回字符串的长度
select length('abcd'); // 4
# concat(str1,str2,...)
# 合并字符串
select concat('abc','def','gh'); // abcdefgh
```

日期时间

```sql
# dayofweek(date)
# 返回date是星期几,1代表星期日,2代表星期一...
select dayofweek('2017-04-09');
# weekday(date)
# 返回date是星期几,0代表星期一,1代表星期二...
select weekday('2017-04-09');
# dayname(date)
# 返回date是星期几(按英文名返回)
select dayname('2017-04-09');
# dayofmonth(date)
# 返回date是一个月中的第几天(范围1-31)
select dayofmonth('2017-04-09');
# dayofyear(date)
# 返回date是一年中的第几天(范围1-366)
select dayofyear('2017-04-09');
# month(date)
#返回date中的月份数值
select month('2017-04-09');
# monthname(date)
# 返回date是几月(按英文名返回)
select monthname('2017-04-09');
# quarter(date)
# 返回date是一年中的第几个季度
select quarter('2017-04-09');
# week(date,first)
# 返回date是一年中的第几周(first默认值是0,表示周日是一周的开始,取值为1表示周一是一周的开始)
select week('2017-04-09');
select week('2017-04-09',1);
# year(date)
# 返回date的年份
select year('2017-04-09');
# hour(time)
# 返回time的小时数
select hour('18:06:53');
# minute(time)
# 返回time的分钟数 select minute('18:06:53');
# second(time)
# 返回time的秒数
select second('18:06:53');
# period_add(p,n)
# 增加n个月到时期p并返回(p的格式为yymm或yyyymm)
select period_add(201702,2);
# period_diff(p1,p2)
# 返回在时期p1和p2之间的月数(p1,p2的格式为yymm或yyyymm)
select period_diff(201605,201704);
# date_format(date,format)
# 根据format字符串格式化date
select date_format('2017-04-09','%d-%m-%y');
# time_format(time,format)
# 根据format字符串格式化time
select time_format('12:22:33','%s-%i-%h');
# curdate() 和 current_date()
# 以'yyyy-mm-dd'或yyyymmdd的格式返回当前日期值
select curdate();
select current_date();
# curtime() 和 current_time()
# 以'hh:mm:ss'或hhmmss格式返回当前时间值
select curtime();
select current_date();
# now(),sysdate(),current_timestamp()
# 以'yyyy-mm-dd hh:mm:ss'或yyyymmddhhmmss格式返回当前日期时间 select now();
select sysdate();
select current_timestamp();
# unix_timestamp()
# 返回一个unix时间戳(从'1970-01-01 00:00:00'开始到当前时间的秒数)
select unix_timestamp();
# sec_to_time(seconds)
# 把秒数seconds转化为时间time
select sec_to_time(3666);
# time_to_sec(time)
# 把时间time转化为秒数seconds
select time_to_sec('01:01:06');
# top N 问题
select * from 表名 limit 0,N; //第0行取N行的数据
```

### 对查询出的数据进行筛选替换 

```python
# 此方式仅限等于条件 select case when 字段条件 then '要显示的值' end from 表名 //此方式条件更多
select 
case sex 
when 1 then '男' 
when 2 then '女' 
else '其他' 
end 
from 表名;
```

# 全文本搜索

```sql
# mysql数据库的MyISAM支持全文本搜索，不支持事务
# 启用全文本搜索
create table 表名
（
	字段名  	类型  	约束，
	note_text  text 	null,
	fulltext(note_text)
）engine=myisam

# 使用全文本搜索
select note_text from 表名
where match(note_text) against('匹配字符串')

# 使用查询扩展
select note_text from 表名
where match(note_text) against('匹配字符串' with query expansion)

# 使用布尔文本搜索
select note_text from 表名
where match(note_text) against('匹配字符串的布尔操作' in boolean mode)
```

| 布尔操作符 | 说明                                                         |
| ---------- | ------------------------------------------------------------ |
| +          | 包含，词必须存在                                             |
| -          | 排除，词必须不出现                                           |
| >          | 包含，增加等级值                                             |
| <          | 包含，减少等级值                                             |
| ()         | 把词组成子表达式<br>允许子表达式作为一个组被包含、排除、排列等 |
| ~          | 取消一个词的排序值                                           |
| *          | 词尾的通配符                                                 |
| ""         | 定义一个短句<br>匹配整个短语以便包含或排除这个短语           |

# 索引

普通索引

```mysql
create index 索引名 on 表名(字段名(索引长度));
alter table 表名 add index 索引名 (字段名(索引长度));
create table 表名(字段名 字段类型,字段名 字段类型,index 索引名(字段名(索引长度));
```
唯一索引

```mysql
create unique index 索引名 on 表名(字段名(索引长度));
alter table 表名 add unique 索引名 (字段名(索引长度));
create table 表名(字段名 字段类型,字段名 字段类型,unique 索引名 (字段名(索引长度));
```
全文索引

```mysql
# 只支持 MyISAM 引擎
create fulltext index 索引名 on 表名(字段名);
alter table 表名 add fulltext 索引名(字段名);
create table 表名(字段名 字段类型,字段名 字段类型,fulltext (字段名)）;
```
组合索引

```mysql
create index 索引名 on 表名(字段名(索引长度),字段名(索引长度),...);
alter table 表名 add index 索引名 (字段名(索引长度),字段名(索引长度),...;
create table 表名(字段名 字段类型,字段名 字段类型,index 索引名 (字段名(索引长度),字段名(索引长度));
```
查看索引

```mysql
show index from 表名;
```
删除索引

```mysql
alter table 表名 drop index 索引名;
```
# 约束

创建时设置约束

```mysql
# 主键约束
create table 表名(字段名 字段类型 primary key,字段 字段类型,...);
create table 表名(字段1 字段类型,字段2 字段类型,primary key(字段1,字段2);  # 联合主键
# 唯一键约束
create table 表名(字段名 字段类型 unique,字段名 字段类型,...);
# 外键约束
create table 表1(字段1 字段类型,字段2 字段类型,foreign key(字段1) references 表2(字段名),...);
# 非空约束
create table 表名(字段名 字段类型 not null,字段名 字段类型,...);
# 默认值约束
create table 表名(字段名 字段类型 default 默认值,字段名 字段类型,...);
# check约束
# (MySQL 不支持)
create table 表名(字段1 字段类型,字段2 字段类型,check(字段1 > 30),...);
```

修改已有表

```sql
alter table xxx drop primary key;
alter table xxx add primary key(字段);

alter table 表1 frop foreign key xxx;
alter table 表1 add constraint 外键名 foreign key (字段) references 表2(字段名)
```

# 事务

- 自动事务提交

MySQL中默认每一条DML语句都是一个单独的事务， 每条语句都会自动开启一个事务，语句执行完毕自动提交事务，Mysq默认开始自动提交事务。

```sql
# 查看是否开启自动提交事务
select @@autocommit;  # 1表示开启，0表示关闭

# 取消自动提交事务
set @@autocommit = 0;
```

- 手动事务提交

```python
# 使用事务提交
begin; 或者 start transaction;  # 开始
...  # sql执行语句
commit;  # 提交

# 使用事务回滚
begin; 或者 start transaction;
...  # sql执行语句
rollback; # 回滚
```

- 设置还原点

```sql
# 创建占位符
savepoint 保留点名
# 回退至保留点
rollback to 保留点名
```